!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Truss=n():e.Truss=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0}),n.PubSubHelper=void 0;var o=t(4),i=r(o),a=t(3);n.PubSubHelper=new i.default;n.default={createInstance:a.createInstance,destroyInstance:a.destroyInstance,destroyModuleInstance:a.destroyModuleInstance,use:a.use}},function(e,n){"use strict";function t(e,n){for(var t=-1,r=e.length;++t<r&&n.indexOf(e.charAt(t))>-1;);return t}function r(e,n){for(var t=e.length;t--&&n.indexOf(e.charAt(t))>-1;);return t}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=-1;n.default={getNextUniqueId:function(){return"UIF-"+ ++i},pick:function(e,n){var t={};return n.forEach(function(n){t[n]=e[n]}),t},length:function(e){return Array.isArray(e)?e.length:"object"===(void 0===e?"undefined":o(e))?Object.keys(e).length:"string"==typeof e?e.length:0},trim:function(e,n){return e.slice(t(e,n),r(e,n)+1)},clearSlashes:function(e){return this.trim(e,"/")},partial:function(e){var n=Array.prototype.slice,t=n.call(arguments,1);return function(){return e.apply(this,t.concat(n.call(arguments,0)))}},getCSSSelector:function(e,n){try{for(var t=""+e.instanceConfig.container,r=e.meta.parent&&e.meta.parent.pointer?e.meta.parent.pointer:void 0;r;)t=r.instanceConfig.container+" "+t,r=r.parent&&r.parent.pointer?r.parent.pointer.meta.id:void 0;return t}catch(o){return""}},configValidator:function(e){var n=!0;return e||(console.error("Config is mandatory to create instance of any module."),n=!1),e.moduleName||(console.error("moduleName property on config is require field to create instance of any module."),n=!1),"string"!=typeof e.moduleName&&(console.error("moduleName property on config should be string."),n=!1),e.module&&"object"===o(e.module)||(console.error("module property on config is mandatory and should be object"),n=!1),(!e.instanceConfig||e.instanceConfig&&!e.instanceConfig.container)&&(console.error("instanceConfig property and instanceConfig.container is mandatory"),n=!1),n||console.dirxml(e),n}}},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r=t([],{insertInstance:function(e){this.push(e)},deleteInstance:function(e){for(var n=this.length-1;n>=0;n--)if(this[n].meta.id===e){this.splice(n,1);break}},findInstance:function(e,n){return e?this.filter(function(n){if(n.meta.id===e)return n}):n?this.filter(function(e){if(e.name===n)return e}):[]}}),o="undefined"!=typeof window,i=!o,a={},u={store:[]},l=[];n.isBrowser=o,n.subscriptions=a,n.moduleS=r,n.isServer=i,n.eventQ=u,n.middleWareFns=l},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,t=void 0;return t="string"==typeof e?d.moduleS.findInstance(e):e.meta?d.moduleS.findInstance(e.meta.id):d.moduleS.findInstance(null,e.name),t.forEach(function(e){e[h.default.MODULE_EVENTS.destroy]&&e[h.default.MODULE_EVENTS.destroy]();var t=n.document.querySelector("#"+e.getUniqueId());t&&t.remove();var r=e.getAllSubscriptions();if(r.forEach(function(n){e.unsubscribe(n.eventName,n.callback)}),e.meta.children&&e.meta.children.length){var i=e.meta.children.map(function(e){return e.pointer});e.meta.children=[],i.forEach(function(e){o(e)})}d.moduleS.deleteInstance(e.meta.id)}),!0}function i(e){if(c.default.configValidator(e)){var n=d.moduleS.filter(function(n){return n.instanceConfig.container===e.instanceConfig.container});n.forEach(function(e){o(e)});var t=[],r=[];return _.call(this,e.moduleName,e,e.module,e.instanceConfig,r),C.call(this,r,t),new Promise(function(e,n){Promise.all(t).then(e).catch(n)})}}function a(e){d.middleWareFns.push(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.destroyInstance=void 0;var u=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};n.destroyModuleInstance=o,n.createInstance=i,n.use=a;var l=t(1),c=r(l),s=t(6),f=r(s),d=t(2),p=t(5),h=r(p),v=function(e,n){e[h.default.MODULE_EVENTS.onStatusChange]&&e[h.default.MODULE_EVENTS.onStatusChange](n)},g=function(e,n){e.publish(""+e.getModuleName()+n,{moduleInstanceId:e.getUniqueId()})},m=function(e){return e.instanceConfig.initOn&&e.lifeCycleFlags.rendered?Promise.resolve(e.path):b(e)},b=function(e,n){if(f.default.createModuleArena(e),e[h.default.MODULE_EVENTS.resolveRenderOn]){var t=e[h.default.MODULE_EVENTS.resolveRenderOn](n);if(t instanceof Promise){var r=function(n){return e.lifeCycleFlags.preRenderResolved=!0,v(e,h.default.onStatusChange_EVENTS.resolveRenderOnCalled),y(e,n)};return t.then(r).catch(r)}return v(e,h.default.onStatusChange_EVENTS.resolveRenderOnCalled),y(e,t)}return v(e,h.default.onStatusChange_EVENTS.resolveRenderOnCalled),y(e,n)},y=function(e,n){return e.instanceConfig.listensTo&&e.instanceConfig.listensTo.length&&e.instanceConfig.listensTo.filter(function(e){if(e.type===h.default.EVENT_ENUM.playAfterRender||!e.type)return e}).forEach(function(n){e.subscribe({eventName:n.eventName,callback:e[n.callback],context:e,eventPublisher:n.eventPublisher,once:n.once})}),v(e,h.default.onStatusChange_EVENTS.listensToPlayAfterRenderSubscribed),E(e,n)},E=function(e,n){return new Promise(function(t,r){var o=e[h.default.MODULE_EVENTS.render](n,o);v(e,h.default.onStatusChange_EVENTS.renderCalled),e[h.default.MODULE_EVENTS.onRenderComplete]&&(e[h.default.MODULE_EVENTS.onRenderComplete](),v(e,h.default.onStatusChange_EVENTS.onRenderCompleteCalled)),t(),e.lifeCycleFlags.rendered=!0,g(e,"_READY")})},C=function O(e,n){var t=e.filter(function(e){return!e.meta.parent.id});t.length||(t=[e[0]]),t.forEach(function(e){var t=new Promise(function(t,r){m(e).then(function(){e.meta.children&&e.meta.children.length&&e.meta.children&&e.meta.children.forEach(function(e){O([e.pointer],n)}),t(e.meta.id)})});n.push(t)})},S=function(e){e.instanceConfig.initOn&&e.subscribe({eventName:e.instanceConfig.initOn.eventName,eventPublisher:e.instanceConfig.initOn.eventPublisher,context:e.instanceConfig,callback:c.default.partial(b,e)}),v(e,h.default.onStatusChange_EVENTS.initOnSubscribed),e.instanceConfig.listensTo&&e.instanceConfig.listensTo.length&&e.instanceConfig.listensTo.filter(function(e){if(e.type===h.default.EVENT_ENUM.keepOn||e.type===h.default.EVENT_ENUM.replay)return e}).forEach(function(n){e.subscribe({eventName:n.eventName,callback:e[n.callback],context:e,eventPublisher:n.eventPublisher,once:n.once,type:n.type})}),v(e,h.default.onStatusChange_EVENTS.keepOnReplaySubscribed)},_=function I(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.module,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.instanceConfig,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=this,a=arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a&&a.meta,s=n.name?n.name.split("."):void 0,p=void 0;if(a&&a.instanceConfig&&a.instanceConfig.modules&&a.instanceConfig.modules.length){var m=a.instanceConfig.modules.filter(function(n){return n.moduleName===e});if(m&&m.length){var b=m[0].instanceConfig||{};r.placeholders=b.placeholders||r.placeholders,r.listensTo=b.listensTo||r.listensTo}}r.placeholders&&t&&t.config&&t.config.placeholders&&(r.placeholders=u(t.config.placeholders,r.placeholders)),this instanceof f.default?!function(){var e=i.getUniqueId();p=d.moduleS.filter(function(n){return n.meta.id===e})}():!a&&s&&2===s.length&&(p=d.moduleS.filter(function(e){return e.name===s[0]})),p&&p.length&&(a=p[0],l=a.meta);var y={id:c.default.getNextUniqueId(),parent:{id:l&&l.id?l.id:void 0,pointer:a},children:[],siblings:l?[].concat(l.children):[]},E=new f.default(n.name,e,h.default.lifeCycleFlags,r,t,y);return d.moduleS.insertInstance(E),o.push(E),S(E),g(E,"_CREATED"),v(E,h.default.onStatusChange_EVENTS.onCreate),l&&(y.siblings=[].concat(l.children),l.children.push({id:y.id,pointer:E})),t.config&&t.config.modules&&t.config.modules.length?void t.config.modules.forEach(function(e){I(e.moduleName,e,e.module,e.instanceConfig,o,E)}):o},N=n.destroyInstance=o;n.default={createInstance:i,destroyInstance:N,destroyModuleInstance:o,use:a}},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,n){for(var t=0;n.length>t;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),a=t(1),u=r(a),l=t(2),c=function(e,n){console.group("Event Subscribed"),console.info(e),console.dirxml(n),console.groupEnd()},s=function(e,n){console.group("Event Published"),console.info(e),console.dirxml(n),console.groupEnd()},f=function(e,n){console.group("Event UnSubscribed"),console.info(e),console.dirxml(n),console.groupEnd()},d=function(){function e(){o(this,e)}return i(e,[{key:"subscribe",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.eventName;l.subscriptions[n]||(l.subscriptions[n]=[]);var t=u.default.pick(e,["callback","context","eventSubscriber","eventPublisher","once","type"]);l.subscriptions[n].push(t),c(n,e)}},{key:"publish",value:function(e,n){var t="";3===arguments.length?(t=arguments[0]||"",e=arguments[1],n=arguments[2]):t=u.default.getCSSSelector(this);var r=l.subscriptions[e];if(r){s(e,{eventName:e,message:n,publisher:t,subscription:r});var o=r.filter(function(e){if("RE_PLAY"===e.type)return e});o.length&&l.eventQ.store.push({eventName:e,message:n,publisher:t}),r&&r.length&&r.forEach(function(r){var o=r.callback,i=r.context,a=r.once,u=!1;if(r.eventPublisher){var c=RegExp(r.eventPublisher+"$");if(c.test(t))u=!0;else{for(var s=t.split(" "),f=r.eventPublisher.split(" "),d=s.length,p=f.length;s.length&&f.length;)d=s.length,p=f.length,s[d-1]===f[p-1]?(s.pop(),f.pop()):s.pop();f.length||(u=!0)}}if(!r.eventPublisher||u){var h=n;"RE_PLAY"===r.type&&(h=l.eventQ.store.filter(function(n){if(n.publisher===t&&n.eventName===e)return n}).map(function(e){return e.message})),o.call(i?i:null,h),a&&(l.subscriptions[e]=l.subscriptions[e].filter(function(e){return e.eventSubscriber!==r.eventSubscriber&&e.eventName!==r.eventName}))}})}}},{key:"unsubscribe",value:function(e,n,t){var r=l.subscriptions[n];if(r){var o=r.filter(function(e){if("RE_PLAY"===e.type)return e});l.subscriptions[n]=r.filter(function(n){return!(n.callback===t&&n.eventSubscriber===e)}),f(n,r),o.length&&(l.subscriptions[n].length||(l.eventQ.store=l.eventQ.store.filter(function(e){if(e.eventName!==n)return e})))}}}]),e}();n.default=d},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={EVENT_ENUM:{keepOn:"KEEP_ON",replay:"RE_PLAY",playAfterRender:"PLAY_AFTER_RENDER"},MODULE_EVENTS:{resolveRenderOn:"resolveRenderOn",render:"render",onRenderComplete:"onRenderComplete",onStatusChange:"__onStatusChange",destroy:"destroy"},onStatusChange_EVENTS:{onCreate:"LIFECYCLE:CREATED",keepOnReplaySubscribed:"LIFECYCLE:KEEP_ON_&_REPLAY_SUBSCRIBED",initOnSubscribed:"LIFECYCLE:INIT_ON_SUBSCRIBED",resolveRenderOnCalled:"LIFECYCLE:RESOLVE_RENDER_ON_CALLED",listensToPlayAfterRenderSubscribed:"LIFECYCLE:LISTENS_TO_PLAY_AFTER_RENDER_SUBSCRIBED",renderCalled:"LIFECYCLE:ON_RENDER_CALLED",onRenderCompleteCalled:"LIFECYCLE:ON_RENDER_CAOMPLETE_CALLED"},lifeCycleFlags:{booted:!0,preRenderResolved:!1,rendered:!1}}},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function a(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},l=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},c=function(){function e(e,n){for(var t=0;n.length>t;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),s=function b(e,n,t){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:b(o,n,t)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(t)},f=t(1),d=r(f),p=t(2),h=t(4),v=r(h),g=t(3),m=function(){var e=new WeakMap,n=function(n){function t(n,r,a,u,c,s){o(this,t);var f=i(this,Object.getPrototypeOf(t).call(this));p.middleWareFns.forEach(function(e){l(f,e(f))}),f.moduleName=r,f.name=n,f.lifeCycleFlags=a,f.instanceConfig=u,f.modulePlaceholders=f.instanceConfig.placeholders,f.createChildInstance=g.createInstance.bind(f),f.meta=s;for(var d in c)f[d]=c[d];return e.set(f,{moduleSubscriptions:[],uniqueId:s.id}),f}return a(t,n),c(t,[{key:"render",value:function(e){var n=this.getUniqueId(),t=e||this.instanceConfig.placeholders;this.template&&(document.querySelector("#"+n).innerHTML=this.template(t))}},{key:"getAllSubscriptions",value:function(){return e.get(this).moduleSubscriptions}},{key:"getUniqueId",value:function(){return e.get(this).uniqueId}},{key:"getParentInstanceId",value:function(){return this.meta.parent?this.meta.parent.id:""}},{key:"getModuleContainer",value:function(){return"#"+this.getUniqueId()}},{key:"getModuleName",value:function(){return this.moduleName}},{key:"getInstanceConfig",value:function(){return this.instanceConfig.placeholders}},{key:"getCSSSelector",value:function(){return d.default.getCSSSelector(this,p.moduleS)}},{key:"destroy",value:function(){}},{key:"subscribe",value:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.eventName;n.eventSubscriber=this.getModuleContainer(),e.get(this).moduleSubscriptions.push(n),s(Object.getPrototypeOf(t.prototype),"subscribe",this).call(this,n,r)}},{key:"publish",value:function(e,n){s(Object.getPrototypeOf(t.prototype),"publish",this).call(this,e,n)}},{key:"unsubscribe",value:function(e,n){"object"===(void 0===e?"undefined":u(e))&&(n=e.callback,e=e.eventName),s(Object.getPrototypeOf(t.prototype),"unsubscribe",this).call(this,this.getModuleContainer(),e,n)}}],[{key:"createModuleArena",value:function(e,n){var t="";return t=e.instanceConfig.moduleClassName?e.instanceConfig.theme?e.instanceConfig.moduleClassName+"-"+e.instanceConfig.theme:e.instanceConfig.moduleClassName+"-default":e.instanceConfig.theme?e.moduleName+"-"+e.instanceConfig.theme:e.moduleName+"-default","string"!=typeof n?void(document.querySelector(e.instanceConfig.container).innerHTML='<div id="'+e.getUniqueId()+'" class="'+t+' play-arena"></div>'):(""===n.trim()&&(n='<div id="'+e.getUniqueId()+'"></div>'),n)}}]),t}(v.default);return n}();n.default=m}])});